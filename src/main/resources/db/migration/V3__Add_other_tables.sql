CREATE TABLE books (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   title VARCHAR(255) NULL,
   author VARCHAR(255) NULL,
   price DOUBLE PRECISION NULL,
   CONSTRAINT pk_books PRIMARY KEY (id)
);

CREATE TABLE buckets (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   user_id BIGINT NULL,
   CONSTRAINT pk_buckets PRIMARY KEY (id),
   CONSTRAINT uc_buckets_user UNIQUE (user_id),
   CONSTRAINT FK_BUCKETS_ON_USER FOREIGN KEY (user_id) REFERENCES users (id)
);

CREATE TABLE order_histories (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   user_id BIGINT NOT NULL,
   CONSTRAINT pk_order_histories PRIMARY KEY (id),
   CONSTRAINT FK_ORDER_HISTORIES_ON_USER FOREIGN KEY (user_id) REFERENCES users (id)
);

CREATE TABLE orders (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   order_history_id BIGINT NOT NULL,
   order_date TIMESTAMP NULL,
   status VARCHAR(255) NULL,
   CONSTRAINT pk_orders PRIMARY KEY (id),
   CONSTRAINT FK_ORDERS_ON_ORDER_HISTORY FOREIGN KEY (order_history_id) REFERENCES order_histories (id)
);

CREATE TABLE order_items (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   order_id BIGINT NOT NULL,
   book_id BIGINT NOT NULL,
   quantity INT NULL,
   price DOUBLE PRECISION NULL,
   CONSTRAINT pk_order_items PRIMARY KEY (id),
   CONSTRAINT FK_ORDER_ITEMS_ON_ORDER FOREIGN KEY (order_id) REFERENCES orders (id),
   CONSTRAINT FK_ORDER_ITEMS_ON_BOOK FOREIGN KEY (book_id) REFERENCES books (id)
);

CREATE TABLE buckets_books (
   id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   bucket_id BIGINT NOT NULL,
   book_id BIGINT NOT NULL,
   CONSTRAINT pk_buckets_books PRIMARY KEY (id, bucket_id),
   CONSTRAINT fk_bucboo_on_bucket_entity FOREIGN KEY (bucket_id) REFERENCES buckets (id),
   CONSTRAINT fk_bucboo_on_book_entity FOREIGN KEY (book_id) REFERENCES books (id)
);